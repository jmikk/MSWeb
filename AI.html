<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 2.1: Types of Machine Learning</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .learning-card { transition: transform 0.2s; }
        .learning-card:hover { transform: translateY(-5px); }
        .hidden-answer { filter: blur(4px); cursor: pointer; transition: filter 0.3s; }
        .hidden-answer:hover { filter: blur(0); }
        #game-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 4px;
            width: 300px;
            height: 300px;
            margin: 0 auto;
        }
        .grid-cell {
            background: #e2e8f0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            position: relative;
        }
        .cell-goal { background: #bbf7d0; border: 2px solid #22c55e; }
        .cell-obstacle { background: #fecaca; }
        .agent {
            width: 80%;
            height: 80%;
            background: #6366f1;
            border-radius: 50%;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        .agent.testing { background: #f59e0b; box-shadow: 0 0 15px #f59e0b; }
        .feedback-flash-reward { animation: reward-flash 0.5s; }
        .feedback-flash-penalty { animation: penalty-flash 0.5s; }
        @keyframes reward-flash {
            0% { background-color: transparent; }
            50% { background-color: rgba(34, 197, 94, 0.2); }
            100% { background-color: transparent; }
        }
        @keyframes penalty-flash {
            0% { background-color: transparent; }
            50% { background-color: rgba(244, 63, 94, 0.2); }
            100% { background-color: transparent; }
        }
        #win-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.9);
            z-index: 50;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-20">

    <!-- Win Modal -->
    <div id="win-modal">
        <div class="bg-white rounded-2xl p-8 max-w-sm w-full text-center shadow-2xl">
            <div id="win-icon" class="text-6xl mb-4">ðŸŽ‰</div>
            <h2 id="win-title" class="text-3xl font-black text-slate-800 mb-2">Goal Reached!</h2>
            <p id="win-desc" class="text-slate-500 mb-6 italic">The AI successfully learned the path through your feedback.</p>
            
            <div class="grid grid-cols-2 gap-4 mb-8">
                <div class="bg-slate-100 p-3 rounded-lg">
                    <p class="text-xs uppercase font-bold text-slate-400">Final Reward</p>
                    <p id="final-reward" class="text-2xl font-bold text-emerald-600">0</p>
                </div>
                <div class="bg-slate-100 p-3 rounded-lg">
                    <p class="text-xs uppercase font-bold text-slate-400">Total Steps</p>
                    <p id="final-steps" class="text-2xl font-bold text-indigo-600">0</p>
                </div>
            </div>

            <div class="flex flex-col gap-3">
                <button onclick="softReset()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl shadow-lg transition-all active:scale-95">
                    Keep Training (Refine Memory)
                </button>
                <button onclick="fullReset()" class="w-full bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold py-3 rounded-xl transition-all active:scale-95">
                    New Random Puzzle (Reset All)
                </button>
            </div>
        </div>
    </div>

    <!-- Header Section -->
    <nav class="bg-indigo-900 text-white p-6 shadow-lg mb-8">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold">Standard 2.1: Machine Learning Types</h1>
                <p class="text-indigo-200">Substitute Teacher Dashboard</p>
            </div>
        </div>
    </nav>

    <main id="main-container" class="max-w-4xl mx-auto px-4 space-y-8">

        <!-- Quick Reference Definitions -->
        <section class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="learning-card bg-purple-600 text-white p-6 rounded-xl shadow-md">
                <h3 class="font-bold text-xl mb-2">Supervised</h3>
                <p class="text-sm opacity-90">Learning with a teacher. Uses <strong>labeled data</strong>.</p>
            </div>
            <div class="learning-card bg-emerald-600 text-white p-6 rounded-xl shadow-md">
                <h3 class="font-bold text-xl mb-2">Unsupervised</h3>
                <p class="text-sm opacity-90">Learning by patterns. Finds <strong>hidden clusters</strong>.</p>
            </div>
            <div class="learning-card bg-rose-600 text-white p-6 rounded-xl shadow-md">
                <h3 class="font-bold text-xl mb-2">Reinforcement</h3>
                <p class="text-sm opacity-90">Learning by <strong>trial and error</strong>. Rewards/Penalties.</p>
            </div>
        </section>

        <!-- Main Activity: The AI Trainer (RL) -->
        <section class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="bg-slate-800 p-4 text-white flex justify-between items-center">
                <h2 class="font-bold">Activity 1: Reinforcement Learning Lab</h2>
                <div id="mode-badge" class="text-[10px] uppercase font-bold bg-blue-500 px-2 py-1 rounded">Phase: Training</div>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <div>
                        <div id="training-controls">
                            <p class="mb-4 text-slate-600 font-bold text-sm">Step 1: Training Phase</p>
                            <p class="mb-4 text-xs text-slate-500">Give the AI feedback to teach it a path. It will remember which moves you rewarded!</p>
                            <div class="bg-slate-100 rounded-xl p-4 text-center border border-slate-200 mb-4">
                                <div class="grid grid-cols-2 gap-2 mb-4">
                                    <div>
                                        <h3 class="text-slate-500 uppercase text-[10px] font-bold tracking-widest mb-1">Score</h3>
                                        <div id="score" class="text-3xl font-black text-slate-800">0</div>
                                    </div>
                                    <div>
                                        <h3 class="text-slate-500 uppercase text-[10px] font-bold tracking-widest mb-1">Steps</h3>
                                        <div id="steps" class="text-3xl font-black text-indigo-600">0</div>
                                    </div>
                                </div>
                                <div class="flex flex-col gap-2">
                                    <button onclick="handleFeedback(10)" class="bg-emerald-500 hover:bg-emerald-600 text-white py-3 rounded-lg font-bold shadow-md active:scale-95 transition-all">REWARD (+10)</button>
                                    <button onclick="handleFeedback(-10)" class="bg-rose-500 hover:bg-rose-600 text-white py-3 rounded-lg font-bold shadow-md active:scale-95 transition-all">PENALTY (-10)</button>
                                </div>
                            </div>
                            <button onclick="startTesting()" class="w-full border-2 border-indigo-600 text-indigo-600 hover:bg-indigo-600 hover:text-white font-bold py-2 rounded-lg transition-all">
                                Finish Training & Test AI â†’
                            </button>
                        </div>
                        <div id="testing-controls" class="hidden">
                            <p class="mb-4 text-indigo-700 font-bold text-sm">Step 2: Testing Phase</p>
                            <p class="mb-4 text-xs text-slate-500">The AI is now using its "Brain" (the rewards you gave) to find the goal without your help.</p>
                            <div class="bg-indigo-50 border border-indigo-200 rounded-xl p-6 text-center">
                                <p class="text-indigo-800 font-bold animate-pulse">AI IS THINKING...</p>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col items-center">
                        <div id="game-grid"></div>
                        <div class="mt-4 flex gap-2">
                            <button onclick="fullReset()" class="bg-slate-200 hover:bg-slate-300 text-slate-700 px-6 py-2 rounded-md font-bold text-xs transition-colors">New Random Puzzle</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Activity 2: Scenario Corner Game -->
        <section class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="bg-slate-800 p-4 text-white">
                <h2 class="font-bold">Activity 2: The ML Corner Game</h2>
            </div>
            <div class="p-6">
                <div id="scenario-container" class="bg-indigo-50 border-l-4 border-indigo-500 p-6 rounded-r-xl">
                    <div id="scenario-text" class="text-xl font-medium text-indigo-900 mb-4 font-serif">Click the button to start the game.</div>
                    <div id="scenario-answer" class="hidden-answer inline-block bg-indigo-200 px-3 py-1 rounded text-indigo-800 font-bold text-sm">Hover to reveal answer</div>
                </div>
                <button onclick="nextScenario()" class="mt-4 w-full bg-indigo-600 text-white py-3 rounded-xl font-bold shadow-md">Next Scenario &rarr;</button>
            </div>
        </section>
    </main>

    <script>
        const gridSize = 5;
        const gridEl = document.getElementById('game-grid');
        const scoreEl = document.getElementById('score');
        const stepsEl = document.getElementById('steps');
        const mainContainer = document.getElementById('main-container');
        const winModal = document.getElementById('win-modal');
        const modeBadge = document.getElementById('mode-badge');
        
        let agentPos = { x: 0, y: 4 };
        let prevPos = { x: 0, y: 4 };
        let lastMove = null;
        let goalPos = { x: 4, y: 0 };
        let obstacles = [{ x: 2, y: 2 }, { x: 1, y: 1 }, { x: 3, y: 3 }];
        let score = 0;
        let stepCount = 0;
        let isTesting = false;
        
        // The "Brain": remembers total reward for [x,y][direction]
        let qTable = {}; 

        function initQ() {
            for(let y=0; y<5; y++) {
                for(let x=0; x<5; x++) {
                    qTable[`${x},${y}`] = { "up": 0, "down": 0, "left": 0, "right": 0 };
                }
            }
        }

        function createGrid() {
            gridEl.innerHTML = '';
            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    if (x === goalPos.x && y === goalPos.y) cell.classList.add('cell-goal');
                    if (obstacles.some(o => o.x === x && o.y === y)) cell.classList.add('cell-obstacle');
                    if (x === agentPos.x && y === agentPos.y) {
                        const agent = document.createElement('div');
                        agent.className = 'agent' + (isTesting ? ' testing' : '');
                        
                        // Arrow logic:
                        if (lastMove) {
                            const rotMap = { 'up': 0, 'right': 90, 'down': 180, 'left': -90 };
                            agent.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" style="width:60%; height:60%; transform: rotate(${rotMap[lastMove]}deg)">
                                <line x1="12" y1="19" x2="12" y2="5"></line>
                                <polyline points="5 12 12 5 19 12"></polyline>
                            </svg>`;
                        }

                        cell.appendChild(agent);
                    }
                    gridEl.appendChild(cell);
                }
            }
        }

        async function handleFeedback(points) {
            if (isTesting) return;
            
            score += points;
            stepCount++;
            scoreEl.innerText = score;
            stepsEl.innerText = stepCount;

            // Update "Brain" based on the move that JUST happened
            if (lastMove) {
                qTable[`${prevPos.x},${prevPos.y}`][lastMove] += points;
            }

            const flashClass = points > 0 ? 'feedback-flash-reward' : 'feedback-flash-penalty';
            mainContainer.classList.add(flashClass);
            setTimeout(() => mainContainer.classList.remove(flashClass), 500);

            if (points < 0) {
                agentPos = { ...prevPos };
                createGrid();
                await new Promise(r => setTimeout(r, 400));
            }

            makeNextMove();
        }

        function makeNextMove() {
            prevPos = { ...agentPos };
            const dirs = [
                { n: "up", x: 0, y: -1 }, { n: "down", x: 0, y: 1 }, 
                { n: "left", x: -1, y: 0 }, { n: "right", x: 1, y: 0 }
            ];

            const validDirs = dirs.filter(d => {
                const newX = agentPos.x + d.x;
                const newY = agentPos.y + d.y;
                return newX >= 0 && newX < gridSize && newY >= 0 && newY < gridSize;
            });
            
            let chosen;
            const state = qTable[`${agentPos.x},${agentPos.y}`];

            if (isTesting) {
                const sorted = validDirs.sort((a,b) => state[b.n] - state[a.n]);
                chosen = Math.random() > 0.05 ? sorted[0] : validDirs[Math.floor(Math.random()*validDirs.length)];
            } else {
                // Training: Mix of exploration (random) and exploitation (using what it learned)
                // Find the best move based on current knowledge
                const bestMove = validDirs.reduce((a, b) => (state[a.n] > state[b.n] ? a : b));
                const bestScore = state[bestMove.n];

                // If we have a good path (score > 0), take it 50% of the time
                // This makes it look "smarter" as it learns, but still explores
                if (bestScore > 0 && Math.random() > 0.5) {
                    chosen = bestMove;
                } else {
                    chosen = validDirs[Math.floor(Math.random() * validDirs.length)];
                }
            }

            lastMove = chosen.n;
            agentPos.x += chosen.x;
            agentPos.y += chosen.y;

            createGrid();
            if (agentPos.x === goalPos.x && agentPos.y === goalPos.y) {
                setTimeout(showWinScreen, 400);
            }
        }

        function startTesting() {
            isTesting = true;
            agentPos = { x: 0, y: 4 };
            stepCount = 0;
            stepsEl.innerText = 0;
            modeBadge.innerText = "Phase: Testing AI";
            modeBadge.className = "text-[10px] uppercase font-bold bg-amber-500 px-2 py-1 rounded";
            document.getElementById('training-controls').classList.add('hidden');
            document.getElementById('testing-controls').classList.remove('hidden');
            createGrid();
            runTestLoop();
        }

        async function runTestLoop() {
            while (isTesting) {
                await new Promise(r => setTimeout(r, 600));
                if (!isTesting) break; 
                stepCount++;
                stepsEl.innerText = stepCount;
                makeNextMove();
                if (agentPos.x === goalPos.x && agentPos.y === goalPos.y) break;
                if (stepCount > 50) {
                    alert("The AI got lost! Try training it more consistently.");
                    softReset();
                    break;
                }
            }
        }

        function showWinScreen() {
            const wasTest = isTesting;
            isTesting = false;
            document.getElementById('final-reward').innerText = score;
            document.getElementById('final-steps').innerText = stepCount;
            document.getElementById('win-title').innerText = wasTest ? "AI Passed the Test!" : "Goal Reached!";
            document.getElementById('win-desc').innerText = wasTest ? "It used its learned knowledge to find the path." : "Training complete! Now try testing it.";
            winModal.style.display = 'flex';
        }

        // Resets position but keeps Q-Table
        function softReset() {
            isTesting = false;
            winModal.style.display = 'none';
            agentPos = { x: 0, y: 4 };
            prevPos = { x: 0, y: 4 };
            score = 0;
            stepCount = 0;
            scoreEl.innerText = 0;
            stepsEl.innerText = 0;
            lastMove = null;
            
            modeBadge.innerText = "Phase: Training";
            modeBadge.className = "text-[10px] uppercase font-bold bg-blue-500 px-2 py-1 rounded";
            document.getElementById('training-controls').classList.remove('hidden');
            document.getElementById('testing-controls').classList.add('hidden');
            createGrid();
        }

        // Resets everything including memory AND randomizes map
        function fullReset() {
            // Randomize obstacles
            obstacles = [];
            while(obstacles.length < 3) {
                const ox = Math.floor(Math.random() * gridSize);
                const oy = Math.floor(Math.random() * gridSize);
                // Prevent spawning on Start (0,4) or Goal (4,0)
                if ((ox === 0 && oy === 4) || (ox === 4 && oy === 0)) continue;
                // Prevent duplicates
                if (!obstacles.some(o => o.x === ox && o.y === oy)) {
                    obstacles.push({ x: ox, y: oy });
                }
            }
            
            initQ();
            softReset();
        }

        const scenarios = [
            { text: "A vacuum robot explores a room, getting points for every piece of dust it picks up.", type: "Reinforcement Learning" },
            { text: "An AI looks at photos tagged as 'Apple' or 'Orange'.", type: "Supervised Learning" },
            { text: "A music app groups songs into 5 new genres based on patterns.", type: "Unsupervised Learning" }
        ];
        let currentScenarioIndex = -1;
        function nextScenario() {
            currentScenarioIndex = (currentScenarioIndex + 1) % scenarios.length;
            document.getElementById('scenario-text').innerText = scenarios[currentScenarioIndex].text;
            document.getElementById('scenario-answer').innerText = "Answer: " + scenarios[currentScenarioIndex].type;
        }

        initQ();
        createGrid();
        nextScenario();
    </script>
</body>
</html>
